window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(m){window.germanized.admin.shipments={params:{},shipments:{},$wrapper:!1,needsSaving:!1,needsShipments:!0,init:function(){var e=germanized.admin.shipments;e.params=wc_gzd_admin_shipments_params,e.$wrapper=m("#panel-order-shipments"),e.needsShipments=e.$wrapper.find("#order-shipment-add").is(":visible"),e.initShipments(),m(document).ajaxComplete(e.onAjaxComplete),m(document).on("click","#order-shipments-list .shipment-header",e.onToggleShipment).on("change","#order-shipments-list :input:visible",e.setNeedsSaving).on("click","#panel-order-shipments #order-shipment-add",e.onAddShipment).on("click","#panel-order-shipments .remove-shipment",e.onRemoveShipment).on("click","#panel-order-shipments button#order-shipments-save",e.onSave).on("click","#panel-order-shipments .notice-dismiss",e.onRemoveNotice)},onAjaxComplete:function(e,n,i){var t=germanized.admin.shipments;if(null!=n&&i.hasOwnProperty("data")){var s=i.data,a=!1;try{a=JSON.parse('{"'+s.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,n){return""===e?n:decodeURIComponent(n)})}catch(e){a=!1}if(a&&a.hasOwnProperty("action")){var r=a.action;"woocommerce_save_order_items"!==r&&"woocommerce_remove_order_item"!==r&&"woocommerce_add_order_item"!==r&&"woocommerce_delete_refund"!==r||t.syncItemQuantities()}}},syncItemQuantities:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_validate_shipment_item_quantities",active:e.getActiveShipmentId()};e.doAjax(n,e.onSyncSuccess)},onSyncSuccess:function(e){var n=germanized.admin.shipments;n.unblock(),n.initShipments(),n.initTiptip()},onSave:function(e){var n=germanized.admin.shipments;return e.preventDefault(),n.save(),!1},save:function(){var e=germanized.admin.shipments;e.block();var n={action:"woocommerce_gzd_save_shipments",active:e.getActiveShipmentId()};e.doAjax(n,e.onSaveSuccess)},initShipment:function(e){var n=germanized.admin.shipments;n.shipments.hasOwnProperty(e)?n.shipments[e].refreshDom():n.shipments[e]=new m.GermanizedShipment(e)},onSaveSuccess:function(e){var n=germanized.admin.shipments;n.initShipments(),n.setNeedsSaving(!1),n.unblock(),n.initTiptip()},getActiveShipmentId:function(){var e=germanized.admin.shipments.$wrapper.find(".order-shipment.active");return 0<e.length&&e.data("shipment")},block:function(){germanized.admin.shipments.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){germanized.admin.shipments.$wrapper.unblock()},getData:function(e){var n=germanized.admin.shipments,i={};return e=e||{},m.each(n.$wrapper.find(":input[name]").serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),i[n.name]=m.makeArray(i[n.name]),i[n.name].push(n.value)):i[n.name]=n.value}),m.extend(i,e),i},doAjax:function(e,n,t){var s=germanized.admin.shipments,i=s.params.ajax_url,a=s.$wrapper,r=!0;a.find(".notice-wrapper").empty(),n=n||s.onAjaxSuccess,t=t||s.onAjaxError,e.hasOwnProperty("refresh_fragments")&&(r=e.refresh_fragments),e.hasOwnProperty("security")||(e.security=s.params.edit_shipments_nonce),e.hasOwnProperty("order_id")||(e.order_id=s.params.order_id),e=s.getData(e),m.ajax({type:"POST",url:i,data:e,success:function(e){if(e.success){r&&e.fragments&&m.each(e.fragments,function(e,n){m(e).replaceWith(n),m(e).unblock()}),n.apply(a,[e]),e.hasOwnProperty("order_needs_new_shipments")&&s.setNeedsShipments(e.order_needs_new_shipments);var i=e.hasOwnProperty("shipments")?e.shipments:{};m.each(s.getShipments(),function(e,n){i.hasOwnProperty(e)&&(n.setIsEditable(i[e].is_editable),n.setIsReturnable(i[e].is_returnable),n.setNeedsItems(i[e].needs_items),n.setWeight(i[e].weight),n.setLength(i[e].length),n.setWidth(i[e].width),n.setHeight(i[e].height))}),e.hasOwnProperty("needs_refresh")&&e.hasOwnProperty("shipment_id")&&s.initShipment(e.shipment_id)}else t.apply(a,[e]),s.unblock(),e.hasOwnProperty("message")?s.addNotice(e.message,"error"):e.hasOwnProperty("messages")&&m.each(e.messages,function(e,n){s.addNotice(n,"error")})},error:function(e){t.apply(a,[e])},dataType:"json"})},onAjaxError:function(e){},onAjaxSuccess:function(e){},onRemoveNotice:function(){m(this).parents(".notice").slideUp(150,function(){m(this).remove()})},addNotice:function(e,n){germanized.admin.shipments.$wrapper.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},getParams:function(){return germanized.admin.shipments.params},onRemoveShipment:function(){var e=germanized.admin.shipments,n=m(this).parents(".order-shipment").data("shipment");return window.confirm(e.getParams().i18n_remove_shipment_notice)&&e.removeShipment(n),!1},removeShipment:function(e){var n=germanized.admin.shipments,i={action:"woocommerce_gzd_remove_shipment",shipment_id:e};n.block(),n.doAjax(i,n.onRemoveShipmentSuccess,n.onRemoveShipmentError)},onRemoveShipmentSuccess:function(e){var n=germanized.admin.shipments,i=n.$wrapper.find("#shipment-"+e.shipment_id);0<i.length&&(i.hasClass("active")?i.find(".shipment-content-wrapper").slideUp(300,function(){i.removeClass("active"),i.remove()}):i.remove()),n.initShipments(),n.unblock()},onRemoveShipmentError:function(e){germanized.admin.shipments.unblock()},onAddShipment:function(){return germanized.admin.shipments.addShipment(),!1},addShipment:function(){var e=germanized.admin.shipments;e.block(),e.doAjax({action:"woocommerce_gzd_add_shipment"},e.onAddShipmentSuccess,e.onAddShipmentError)},onAddShipmentSuccess:function(e){var n=germanized.admin.shipments;0<n.$wrapper.find(".order-shipment.active").length?n.$wrapper.find(".order-shipment.active").find(".shipment-content-wrapper").slideUp(300,function(){n.$wrapper.find(".order-shipment.active").removeClass("active"),n.$wrapper.find("#order-shipments-list").append(e.new_shipment),n.initShipments(),n.initTiptip(),n.unblock()}):(n.$wrapper.find("#order-shipments-list").append(e.new_shipment),n.initShipments(),n.initTiptip(),n.unblock())},onAddShipmentError:function(e){},setNeedsSaving:function(e){var n=germanized.admin.shipments,i=n.getShipment(n.getActiveShipmentId()).getShipment();"boolean"!=typeof e&&(e=!0),n.needsSaving=!0===e,n.needsSaving?n.$wrapper.find("#order-shipments-save").show():n.$wrapper.find("#order-shipments-save").hide(),n.needsSaving?n.disableCreateLabel(i):n.enableCreateLabel(i),n.hideOrShowFooter(),m(document.body).trigger("woocommerce_gzd_shipments_needs_saving",[n.needsSaving,n.getActiveShipmentId()]),n.initTiptip()},disableCreateLabel:function(e){var n=germanized.admin.shipments,i=e.find(".create-shipment-label");0<i.length&&(i.addClass("disabled button-disabled"),i.prop("title",n.params.i18n_create_label_disabled))},enableCreateLabel:function(e){var n=germanized.admin.shipments,i=e.find(".create-shipment-label");0<i.length&&(i.removeClass("disabled button-disabled"),i.prop("title",n.params.i18n_create_label_enabled))},setNeedsShipments:function(e){var n=germanized.admin.shipments;"boolean"!=typeof e&&(e=!0),n.needsShipments=!0===e,n.needsShipments?(n.$wrapper.addClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").show()):(n.$wrapper.removeClass("needs-shipments"),n.$wrapper.find("#order-shipment-add").hide()),n.hideOrShowFooter()},hideOrShowFooter:function(){var e=germanized.admin.shipments;e.needsSaving||e.needsShipments?e.$wrapper.find(".panel-footer").slideDown(300):e.$wrapper.find(".panel-footer").slideUp(300)},onToggleShipment:function(){var e=germanized.admin.shipments,n=m(this).parents(".order-shipment:first"),i=n.hasClass("active");n.hasClass("shipment-return")?e.closeReturns(n.parents(".shipment-return-list")):e.closeShipments(),i||n.find("> .shipment-content-wrapper").slideDown(300,function(){n.addClass("active")})},closeReturns:function(e){germanized.admin.shipments;e.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,function(){e.find(".order-shipment.active").removeClass("active")})},closeShipments:function(){var e=germanized.admin.shipments;e.$wrapper.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,function(){e.$wrapper.find(".order-shipment.active").removeClass("active")})},initShipments:function(){var n=germanized.admin.shipments;n.$wrapper.find(".order-shipment").each(function(){var e=m(this).data("shipment");n.initShipment(e)})},getShipments:function(){return germanized.admin.shipments.shipments},getShipment:function(e){var n=germanized.admin.shipments.getShipments();return!!n.hasOwnProperty(e)&&n[e]},refresh:function(e){},refreshItems:function(e){},addItem:function(){},initTiptip:function(){var e=germanized.admin.shipments;m(document.body).trigger("init_tooltips"),e.$wrapper.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),e.$wrapper.find(".create-shipment-label").tipTip({fadeIn:50,fadeOut:50,delay:200})}},m(document).ready(function(){germanized.admin.shipments.init()})}(jQuery);