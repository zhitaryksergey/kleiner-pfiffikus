jQuery(function(c){var n,e=!1;function a(){0===c("#pay_with_amazon").length||0<c("#pay_with_amazon").html().length||new OffAmazonPayments.Widgets.Button({sellerId:amazon_payments_advanced_params.seller_id,useAmazonAddressBook:!amazon_payments_advanced_params.is_checkout_pay_page,onSignIn:function(e){n=e.getAmazonOrderReferenceId(),window.location=amazon_payments_advanced_params.redirect+"&amazon_reference_id="+n}}).bind("pay_with_amazon")}function o(){return"amazon_payments_advanced"===c("input[name=payment_method]:checked").val()}a(),c("body").on("updated_shipping_method",a),c("body").on("updated_checkout",function(){o()&&(d(),c("#amazon_customer_details").show(),c("#customer_details :input").detach()),a()}),c(document.body).on("updated_cart_totals",function(){a()}),c("form.checkout").on("checkout_place_order",function(){c(":checkbox[name=createaccount]").is(":checked")&&c(this).find(":input[name=billing_email],:input[name=account_password]").each(function(){var e=c(this);""===e.val()&&e.is(":hidden")&&e.attr("disabled","disabled")})}),amazon_payments_advanced_params.multi_currency_supported&&amazon_payments_advanced_params.multi_currency_reload_wallet&&c(document.body).on("updated_checkout",function(){jQuery.ajax({url:amazon_payments_advanced_params.ajax_url,type:"post",data:{action:"amazon_get_currency",nonce:amazon_payments_advanced_params.multi_currency_nonce},success:function(e){r(e)}})});var t=null;function r(e){if(t=t||new OffAmazonPayments.Widgets.Wallet({sellerId:amazon_payments_advanced_params.seller_id,amazonOrderReferenceId:n||amazon_payments_advanced_params.reference_id,design:{designMode:"responsive"}}),amazon_payments_advanced_params.multi_currency_supported){var a=e||amazon_payments_advanced_params.current_currency;t.setPresentmentCurrency(a)}t.bind("amazon_wallet_widget")}function d(){e||(new OffAmazonPayments.Widgets.AddressBook({sellerId:amazon_payments_advanced_params.seller_id,amazonOrderReferenceId:n||amazon_payments_advanced_params.reference_id,onAddressSelect:function(e){c("body").trigger("update_checkout")},design:{designMode:"responsive"}}).bind("amazon_addressbook_widget"),r(),e=!0,function(){if("function"!=typeof MutationObserver)return;var a=!1,n=new MutationObserver(function(e){e.forEach(function(e){a||(c(document).trigger("wc_amazon_pa_widget_ready"),a=!0,n.disconnect())})});n.observe(document.getElementById("amazon_wallet_widget"),{childList:!0})}())}function s(e,a){c(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),a.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),a.removeClass("processing").unblock(),a.find(".input-text, select, input:checkbox").trigger("validate").blur(),function(){var e=c(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=c(".form.checkout"));c.scroll_to_notices(e)}(),c(document.body).trigger("checkout_error")}o()&&d(),c("form.checkout").on("checkout_place_order",function(e){if(!o())return!0;if(!amazon_payments_advanced_params.is_sca)return!0;var a=c(this);return OffAmazonPayments.initConfirmationFlow(amazon_payments_advanced_params.seller_id,n||amazon_payments_advanced_params.reference_id,function(e){!function(o,t){t.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.ajax({type:"post",url:amazon_payments_advanced_params.ajax_url,data:{action:"amazon_sca_processing",nonce:amazon_payments_advanced_params.sca_nonce,data:c("form.checkout").serialize()},success:function(e){if("success"===e.result)o.success();else if("failure"===e.result){if(o.error(),!0===e.reload)return void window.location.reload();!0===e.refresh&&c(document.body).trigger("update_checkout"),s(e.messages,t)}},error:function(e,a,n){o.error(),s('<div class="woocommerce-error">'+n+"</div>",t)}})}(e,a)}),e.preventDefault(),!1})});
