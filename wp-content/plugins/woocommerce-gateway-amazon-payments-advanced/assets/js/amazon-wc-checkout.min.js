!function(s){s(function(){var i=0,e="#pay_with_amazon";function a(){!function(){var e=s("#wc-apa-update-vals");if(!e.length)return;var a=e.data("value");s.extend(amazon_payments_advanced,a),e.remove()}(),0!==s(e).length&&(i++,s(e).each(function(){var e=s(this);if(e.is(":visible")){var a=e.attr("id");void 0===a&&(a="pay_with_amazon_"+i,e.attr("id",a));var n=a;a="#"+a;var o={merchantId:amazon_payments_advanced.merchant_id,ledgerCurrency:amazon_payments_advanced.ledger_currency,sandbox:"1"===amazon_payments_advanced.sandbox,productType:amazon_payments_advanced.action,placement:amazon_payments_advanced.placement,buttonColor:amazon_payments_advanced.button_color,checkoutLanguage:""!==amazon_payments_advanced.button_language?amazon_payments_advanced.button_language.replace("-","_"):void 0,createCheckoutSessionConfig:amazon_payments_advanced.create_checkout_session_config},t=amazon_payments_advanced.create_checkout_session_hash,c=e.data("amazonRenderedSettings");if(void 0!==c){if(c===t)return;var d=s("<"+e.get(0).tagName+"/>").attr("id",n);d.insertBefore(e),e.remove(),e=d}e.data("amazonRenderedSettings",t),amazon.Pay.renderButton(a,o),e.siblings(".wc-apa-button-separator").show()}}))}function n(e,a){var n=s(e);0!==n.length&&n.data("wc_apa_chage_bind")!==a&&(n.data("wc_apa_chage_bind",a),n.on("click",function(e){e.preventDefault()}),amazon.Pay.bindChangeAction(e,{amazonCheckoutSessionId:amazon_payments_advanced.checkout_session_id,changeAction:a}))}function o(e){0===s("."+e+"__field-wrapper").children().filter(function(){return s(this).is(":not(.hidden)")&&"none"!==s(this).css("display")}).length?s("."+e).addClass("hidden"):s("."+e).removeClass("hidden")}function c(e){e.removeClass("processing").unblock()}function t(e){var o=s(this);if(e.preventDefault(),!o.data("sending")){o.data("sending",!0);var t=o.parents(".create-account");!function(e){!function(e){return e.is(".processing")||e.parents(".processing").length}(e)&&e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}(t),s.ajax({type:"post",url:o.prop("href"),success:function(e){c(t),o.data("sending",!1)},error:function(e,a,n){c(t),o.data("sending",!1)}})}}function d(){if("amazon_payments_advanced"===s("input[name=payment_method]:checked").val()){if(o("woocommerce-billing-fields"),o("woocommerce-shipping-fields"),o("woocommerce-additional-fields"),n("#payment_method_widget_change","changePayment"),n("#shipping_address_widget_change","changeAddress"),0<s(".woocommerce-billing-fields .woocommerce-billing-fields__field-wrapper > *").length&&s(".woocommerce-billing-fields").insertBefore("#payment"),0<s(".woocommerce-account-fields").length&&s(".woocommerce-account-fields").insertBefore("#wc-apa-account-fields-anchor"),0<s(".woocommerce-shipping-fields .woocommerce-shipping-fields__field-wrapper > *").length){var e=s("#ship-to-different-address");e.find(":checkbox#ship-to-different-address-checkbox").hide(),e.find("span").text(amazon_payments_advanced.shipping_title),s(".woocommerce-shipping-fields").insertBefore("#payment")}s(".woocommerce-additional-fields").insertBefore("#payment"),s(".wc-apa-send-confirm-ownership-code").on("click",t)}}a(),s(document.body).on("updated_wc_div",a),s(document.body).on("updated_checkout",a),s(document.body).on("payment_method_selected",a),d(),s("body").on("updated_checkout",d),s("body").on("payment_method_selected",d)})}(jQuery);
